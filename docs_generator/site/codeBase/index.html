



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation on design and deployment of OmniBot catkin package">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.2">
    
    
      
        <title>Code Base - OmniRobot</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.ba0fd1a6.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#code-base" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="OmniRobot" class="md-header-nav__button md-logo">
          
            <img src="../images/OmniRobot_wheelLogo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                OmniRobot
              </span>
              <span class="md-header-nav__topic">
                Code Base
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/jvillagomez/omnibot_pkg/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      jvillagomez/omnibot_pkg
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../images/OmniRobot_wheelLogo.png" width="48" height="48">
      
    </span>
    OmniRobot
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/jvillagomez/omnibot_pkg/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      jvillagomez/omnibot_pkg
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../gettingStarted/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../systemArchitecture/" title="System Architecture" class="md-nav__link">
      System Architecture
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../components/" title="Components" class="md-nav__link">
      Components
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Code Base
      </label>
    
    <a href="./" title="Code Base" class="md-nav__link md-nav__link--active">
      Code Base
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#launch-files" title="Launch Files" class="md-nav__link">
    Launch Files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#omnibot" title="Omnibot" class="md-nav__link">
    Omnibot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#omnibot-dev" title="Omnibot Dev" class="md-nav__link">
    Omnibot Dev
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script-files" title="Script Files" class="md-nav__link">
    Script Files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ultrasound-node" title="Ultrasound Node" class="md-nav__link">
    Ultrasound Node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rosserial-arduino" title="ROSserial (Arduino)" class="md-nav__link">
    ROSserial (Arduino)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#start-rosserial-node" title="Start ROSserial Node" class="md-nav__link">
    Start ROSserial Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#motors-only-no-ros" title="Motors Only (No ROS)" class="md-nav__link">
    Motors Only (No ROS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#motor-control-flow-wros" title="Motor Control Flow (w/ROS)" class="md-nav__link">
    Motor Control Flow (w/ROS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#motors-only-w-ros" title="Motors Only (w/ ROS)" class="md-nav__link">
    Motors Only (w/ ROS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensors-only-w-ros" title="Sensors Only (w/ ROS)" class="md-nav__link">
    Sensors Only (w/ ROS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#motors-sensors-w-ros" title="Motors + Sensors (w/ ROS)" class="md-nav__link">
    Motors + Sensors (w/ ROS)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script-files-dev-only" title="Script Files (Dev Only)" class="md-nav__link">
    Script Files (Dev Only)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#velocity-publisher-node" title="Velocity Publisher Node" class="md-nav__link">
    Velocity Publisher Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#velocity-publisher-node-1" title="Velocity Publisher Node 1" class="md-nav__link">
    Velocity Publisher Node 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#velocity-publisher-node-2" title="Velocity Publisher Node 2" class="md-nav__link">
    Velocity Publisher Node 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../serialLatency/" title="Serial Latency" class="md-nav__link">
      Serial Latency
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../wifiLocalization/" title="Wifi Localization" class="md-nav__link">
      Wifi Localization
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../projectSlackChannel/" title="Project Slack Channel" class="md-nav__link">
      Project Slack Channel
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#launch-files" title="Launch Files" class="md-nav__link">
    Launch Files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#omnibot" title="Omnibot" class="md-nav__link">
    Omnibot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#omnibot-dev" title="Omnibot Dev" class="md-nav__link">
    Omnibot Dev
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script-files" title="Script Files" class="md-nav__link">
    Script Files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ultrasound-node" title="Ultrasound Node" class="md-nav__link">
    Ultrasound Node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rosserial-arduino" title="ROSserial (Arduino)" class="md-nav__link">
    ROSserial (Arduino)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#start-rosserial-node" title="Start ROSserial Node" class="md-nav__link">
    Start ROSserial Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#motors-only-no-ros" title="Motors Only (No ROS)" class="md-nav__link">
    Motors Only (No ROS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#motor-control-flow-wros" title="Motor Control Flow (w/ROS)" class="md-nav__link">
    Motor Control Flow (w/ROS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#motors-only-w-ros" title="Motors Only (w/ ROS)" class="md-nav__link">
    Motors Only (w/ ROS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensors-only-w-ros" title="Sensors Only (w/ ROS)" class="md-nav__link">
    Sensors Only (w/ ROS)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#motors-sensors-w-ros" title="Motors + Sensors (w/ ROS)" class="md-nav__link">
    Motors + Sensors (w/ ROS)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script-files-dev-only" title="Script Files (Dev Only)" class="md-nav__link">
    Script Files (Dev Only)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#velocity-publisher-node" title="Velocity Publisher Node" class="md-nav__link">
    Velocity Publisher Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#velocity-publisher-node-1" title="Velocity Publisher Node 1" class="md-nav__link">
    Velocity Publisher Node 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#velocity-publisher-node-2" title="Velocity Publisher Node 2" class="md-nav__link">
    Velocity Publisher Node 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jvillagomez/omnibot_pkg/edit/master/docs/codeBase.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="code-base">Code Base</h1>
<h2 id="launch-files">Launch Files</h2>
<h3 id="omnibot">Omnibot</h3>
<p>'launch/omnibot.launch'</p>
<p>Starts up nodes for production. Robot listens for velocity updates.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span class="nt">&lt;launch&gt;</span>
   <span class="c">&lt;!-- Start Ultrasound Node --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;ultrasoundPublisher_node&quot;</span> <span class="na">pkg=</span><span class="s">&quot;omnibot&quot;</span> <span class="na">type=</span><span class="s">&quot;ultrasoundPublisher_node.py&quot;</span> <span class="nt">/&gt;</span>
   <span class="c">&lt;!-- Start ROSserial node --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;arduino_node&quot;</span> <span class="na">pkg=</span><span class="s">&quot;omnibot&quot;</span> <span class="na">type=</span><span class="s">&quot;start_rosserial.sh&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</td></tr></table>

<h3 id="omnibot-dev">Omnibot Dev</h3>
<p>'launch/omnibot_dev.launch'</p>
<p>Starts up nodes for development and troubleshooting. Robot listens to incoming velocities from velocityPublisher node.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span class="nt">&lt;launch&gt;</span>
  <span class="c">&lt;!--  Start velocityPublisher Node--&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;velocityPublisher_node&quot;</span> <span class="na">pkg=</span><span class="s">&quot;omnibot&quot;</span> <span class="na">type=</span><span class="s">&quot;velocityPublisher_node.py&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!--  Start Ultrasound Node --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;ultrasoundPublisher_node&quot;</span> <span class="na">pkg=</span><span class="s">&quot;omnibot&quot;</span> <span class="na">type=</span><span class="s">&quot;ultrasoundPublisher_node.py&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!--  Start ROSserial Node--&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;arduino_node&quot;</span> <span class="na">pkg=</span><span class="s">&quot;omnibot&quot;</span> <span class="na">type=</span><span class="s">&quot;start_rosserial.sh&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</td></tr></table>

<h2 id="script-files">Script Files</h2>
<h3 id="ultrasound-node">Ultrasound Node</h3>
<p>'scripts/ultrasoundPublisher_node.py'</p>
<p>Publishes an integer value representing distance to target in millimeters</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c">#!/usr/bin/python</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">serial</span> <span class="kn">import</span> <span class="n">Serial</span> <span class="c"># import library allowing python to interact with serial port</span>
<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">Int8</span> <span class="c"># distance acquired will be fit into an 8bit variable</span>

<span class="n">serialDevice</span> <span class="o">=</span> <span class="s">&quot;/dev/ttyAMA0&quot;</span> <span class="c"># default for RaspberryPi</span>
<span class="n">maxwait</span> <span class="o">=</span> <span class="mi">5</span> <span class="c"># seconds to try for a good reading before quitting</span>

<span class="c"># Function was obtained from the Maxbotix website.</span>
<span class="c"># https://www.maxbotix.com/wp-content/uploads/2017/09/074_raspPi.txt</span>
<span class="k">def</span> <span class="nf">get_measurement</span><span class="p">(</span><span class="n">portName</span><span class="p">):</span>
    <span class="n">ser</span> <span class="o">=</span> <span class="n">Serial</span><span class="p">(</span><span class="n">portName</span><span class="p">,</span> <span class="mi">9600</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">timeStart</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="n">valueCount</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">timeStart</span> <span class="o">+</span> <span class="n">maxwait</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">():</span>
            <span class="n">bytesToRead</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">()</span>
            <span class="n">valueCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">valueCount</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="c"># 1st reading may be partial number; throw it out</span>
                <span class="k">continue</span>
            <span class="n">testData</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">bytesToRead</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">testData</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;R&#39;</span><span class="p">):</span>
                <span class="c"># data received did not start with R</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sensorData</span> <span class="o">=</span> <span class="n">testData</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="c"># data received could not be decoded properly</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sensorData</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c"># value is not a number</span>
                <span class="k">continue</span>
            <span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span>

    <span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Expected serial data not received&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">publish_measurement</span><span class="p">(</span><span class="n">portName</span><span class="p">):</span>
    <span class="c"># Declare publisher</span>
    <span class="c"># Transmitting to =&gt; ultrasoundDistance_topic</span>
    <span class="c"># Using the &#39;Int8&#39; message type</span>
    <span class="c"># A maximnum of 10 messages will be held in the message queue.</span>
    <span class="n">pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s">&#39;ultrasoundDistance_topic&#39;</span><span class="p">,</span> <span class="n">Int8</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s">&#39;ultrasoundPublisher_node&#39;</span><span class="p">)</span>
    <span class="c"># 10 readings will be published per second</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c"># 10hz</span>

    <span class="c"># This keeps the node running until the script is shut down manually.</span>
    <span class="c"># node will keep cycling at the frequncy set above.</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
        <span class="c"># obtain measurement</span>
        <span class="n">measurement</span> <span class="o">=</span> <span class="n">get_measurement</span><span class="p">(</span><span class="n">portName</span><span class="p">)</span>

        <span class="c"># Log measurment to the terminal.</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">measurement</span><span class="p">)</span>
        <span class="c"># publish measurmeent to the &#39;ultrasoundDistance_topic&#39;.</span>
        <span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">measurement</span><span class="p">)</span>
        <span class="c"># Causes ROS to pause, to ensure its cycleing at the frequency set above.</span>
        <span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">publish_measurement</span><span class="p">(</span><span class="n">serialDevice</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h2 id="rosserial-arduino">ROSserial (Arduino)</h2>
<h3 id="start-rosserial-node">Start ROSserial Node</h3>
<p>'scripts/start_rosserial.bash'</p>
<p>Starts up rosserial node (arduino). Run only after arduino is physically connected.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c">#!/bin/bash</span>
rosrun rosserial_python serial_node.py _port:<span class="o">=</span>/dev/ttyACM0
</pre></div>
</td></tr></table>

<h3 id="motors-only-no-ros">Motors Only (No ROS)</h3>
<p>'scripts/arduino/basicMotor_noROS.ino'</p>
<p>Starts up three step motors at 60 rpms each. ROS is not needed, as script starts up automatically with power source.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="codehilite"><pre><span class="cp">#include &lt;Wire.h&gt;</span>
<span class="cp">#include &lt;Adafruit_MotorShield.h&gt; </span><span class="c1">// library nbeeded to interact with motorshields</span>

<span class="c1">// Declare motorshield objects at their locations</span>
<span class="n">Adafruit_MotorShield</span> <span class="nf">AFMStop</span><span class="p">(</span><span class="mh">0x61</span><span class="p">);</span>
<span class="n">Adafruit_MotorShield</span> <span class="nf">AFMSbot</span><span class="p">(</span><span class="mh">0x60</span><span class="p">);</span>

<span class="c1">// Get motor handler objects from motorshield objects</span>
<span class="c1">// Documentation on motors states 200 steps per rev</span>
<span class="c1">// AFMStop.getStepper(200, 2) =&gt; AFMStop.getStepper(#OfSteps, motorShieldPort#)</span>
<span class="n">Adafruit_StepperMotor</span> <span class="o">*</span><span class="n">stepMotor_1</span> <span class="o">=</span> <span class="n">AFMStop</span><span class="p">.</span><span class="n">getStepper</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">Adafruit_StepperMotor</span> <span class="o">*</span><span class="n">stepMotor_2</span> <span class="o">=</span> <span class="n">AFMSbot</span><span class="p">.</span><span class="n">getStepper</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">Adafruit_StepperMotor</span> <span class="o">*</span><span class="n">stepMotor_3</span> <span class="o">=</span> <span class="n">AFMSbot</span><span class="p">.</span><span class="n">getStepper</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// NOTE velocities are in rpm!!!!</span>
<span class="kt">float</span> <span class="n">stepMotor1_vel</span><span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">stepMotor2_vel</span><span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">stepMotor3_vel</span><span class="o">=</span> <span class="mi">60</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>  
  <span class="n">AFMSbot</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="c1">// Initialize the bottom shield</span>
  <span class="n">AFMStop</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="c1">// Initialize the top shield</span>

  <span class="n">stepMotor_1</span><span class="o">-&gt;</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">stepMotor1_vel</span><span class="p">);</span> <span class="c1">// top </span>
  <span class="n">stepMotor_2</span><span class="o">-&gt;</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">stepMotor2_vel</span><span class="p">);</span> <span class="c1">// bot</span>
  <span class="n">stepMotor_3</span><span class="o">-&gt;</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">stepMotor3_vel</span><span class="p">);</span> <span class="c1">// bot</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// NOTE =&gt; step(#OfSteps, direction, stepType)</span>

  <span class="c1">// clockwise</span>
  <span class="n">stepMotor_1</span><span class="o">-&gt;</span><span class="n">step</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">FORWARD</span><span class="p">,</span> <span class="n">DOUBLE</span><span class="p">);</span>
  <span class="c1">// counter-clockwise</span>
  <span class="n">stepMotor_2</span><span class="o">-&gt;</span><span class="n">step</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BACKWARD</span><span class="p">,</span> <span class="n">DOUBLE</span><span class="p">);</span>
  <span class="c1">// clockwise</span>
  <span class="n">stepMotor_3</span><span class="o">-&gt;</span><span class="n">step</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">FORWARD</span><span class="p">,</span> <span class="n">DOUBLE</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="motor-control-flow-wros">Motor Control Flow (w/ROS)</h3>
<p>Below is a simplified version of teh arduino control loop and ROS cycle, when controlling the step motors.
<img alt="alt Motor Control Flow" src="../images/motorControlFlow.jpg" title="Motor Control Flow" /></p>
<h3 id="motors-only-w-ros">Motors Only (w/ ROS)</h3>
<p>'scripts/arduino/basicMotor_wROS.ino'</p>
<p>Starts up three step motors at 0 rpms each. ROS is used to subscribe for velocity updates. Velocities are not actuaized until a power source is connected. Features 2 publsihers that transmit angular displacements and velocities of each motor.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201</pre></div></td><td class="code"><div class="codehilite"><pre><span class="cp">#include &lt;Wire.h&gt;</span>
<span class="cp">#include &lt;Adafruit_MotorShield.h&gt; </span><span class="c1">// library nbeeded to interact with motorshields</span>
<span class="cp">#include &lt;ros.h&gt; </span><span class="c1">// library needed for ROS communication</span>
<span class="cp">#include &lt;omnibot/MotorArray.h&gt; </span><span class="c1">// library needed for custom ROS &#39;MotorArray&#39; msg type</span>

<span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span> <span class="c1">// Instantiate ros handler object</span>

<span class="c1">// Declare motorshield objects</span>
<span class="c1">// This allows us to then interact with motors attached to our</span>
<span class="c1">// motorshields.</span>
<span class="n">Adafruit_MotorShield</span> <span class="nf">AFMStop</span><span class="p">(</span><span class="mh">0x61</span><span class="p">);</span>
<span class="n">Adafruit_MotorShield</span> <span class="nf">AFMSbot</span><span class="p">(</span><span class="mh">0x60</span><span class="p">);</span>

<span class="c1">// Initialize motor handler objects from the ports on the motorshields.</span>
<span class="c1">// AFMStop.getStepper(200, 2) =&gt; motorShieldObject.getSTepper</span>
<span class="n">Adafruit_StepperMotor</span> <span class="o">*</span><span class="n">stepMotor_1</span> <span class="o">=</span> <span class="n">AFMStop</span><span class="p">.</span><span class="n">getStepper</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">Adafruit_StepperMotor</span> <span class="o">*</span><span class="n">stepMotor_2</span> <span class="o">=</span> <span class="n">AFMSbot</span><span class="p">.</span><span class="n">getStepper</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">Adafruit_StepperMotor</span> <span class="o">*</span><span class="n">stepMotor_3</span> <span class="o">=</span> <span class="n">AFMSbot</span><span class="p">.</span><span class="n">getStepper</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// Declare array of step motors</span>
<span class="c1">// Array is declared to 4 members, but we only index motors from 1-3</span>
<span class="c1">// This was done for clarity of new users.</span>
<span class="n">Adafruit_StepperMotor</span><span class="o">*</span> <span class="n">motorArray</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

<span class="c1">// Initialize motors at angular_vel=0; available globally</span>
<span class="c1">// NOTE =&gt; Velocities are in RPMs !!</span>
<span class="kt">float</span> <span class="n">velocityArray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span> 

<span class="c1">// Step motors will vibrate regardless of what velocity is sent to the motor.</span>
<span class="c1">// If motor velocity is &#39;0&#39;, the motor will still vibrate.</span>
<span class="c1">// To avoid this, we define a thershold. if the desired velocity is below </span>
<span class="c1">// this threshold, no step will be issued to the motor.</span>
<span class="c1">// The motor velocity variables will still reflect this desired velosity, </span>
<span class="c1">// even if it crosses the threshold.</span>
<span class="kt">float</span> <span class="n">velocityThreshold</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="c1">// Declare custom made variables that will hold our velocities and displacements,</span>
<span class="c1">// that will be published to their respective topics.</span>
<span class="n">omnibot</span><span class="o">::</span><span class="n">MotorArray</span> <span class="n">currentVelocities</span><span class="p">;</span>
<span class="n">omnibot</span><span class="o">::</span><span class="n">MotorArray</span> <span class="n">angularDisplacements</span><span class="p">;</span> <span class="c1">// NOTE DISPLACEMNTS ARE IN RADIANS!!</span>

<span class="c1">// Callback function for &#39;setStepMotorVelocity_topic&#39; subscriber below. </span>
<span class="c1">// Updates velocity variables from FIFO queue, but does not send a step </span>
<span class="c1">// command to the motors.</span>
<span class="c1">// The velocityArray is globally available. After this function updates </span>
<span class="c1">// its values, the array is available for any other function to use.</span>
<span class="c1">// The desired values are assign to the velocityArray, rgardless of </span>
<span class="c1">// whether they are wihtin the threshold or not.</span>
<span class="kt">void</span> <span class="nf">updateMotorVelocities</span><span class="p">(</span> <span class="k">const</span> <span class="n">omnibot</span><span class="o">::</span><span class="n">MotorArray</span><span class="o">&amp;</span> <span class="n">velocity_msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// assign velocityArray values as recieved from &#39;setStepMotorVelocity_topic&#39; </span>
  <span class="n">velocityArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocity_msg</span><span class="p">.</span><span class="n">motor1</span><span class="p">;</span> <span class="n">velocityArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocity_msg</span><span class="p">.</span><span class="n">motor2</span><span class="p">;</span> <span class="n">velocityArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocity_msg</span><span class="p">.</span><span class="n">motor3</span><span class="p">;</span>

  <span class="c1">// The absolute value of the velocityArray values is sent to the motors.</span>
  <span class="c1">// Negative values sent to the motors cause incorrect rotation.</span>
  <span class="c1">// To actualize direction (CW and CCW), we use the &quot;BACKWARD&quot;/&quot;FORWARD&quot; parameters in the step command.</span>
  <span class="n">motorArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
  <span class="n">motorArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
  <span class="n">motorArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]));</span>
<span class="p">}</span>

<span class="c1">// Decides whether a desired velocity (absolute value of desired velocity) </span>
<span class="c1">// is above (TRUE) the threshold, or below (FALSE).</span>
<span class="kt">bool</span> <span class="nf">velocityIsAboveThreshold</span><span class="p">(</span><span class="kt">float</span> <span class="n">motorVel</span><span class="p">,</span> <span class="kt">float</span> <span class="n">threshold</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">motorVel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Grabs the values of the desired velocities, but takes the threshold </span>
<span class="c1">// value nto consideration. If the value is above the threshold, </span>
<span class="c1">// the velocity is returned. if value is below th ethreshold, a &#39;0&#39; is returned.</span>
<span class="kt">float</span> <span class="nf">getCurrentMotorVelocity</span><span class="p">(</span><span class="kt">float</span> <span class="n">velocity</span><span class="p">,</span> <span class="kt">float</span> <span class="n">threshold</span><span class="p">)</span>
<span class="p">{</span> 
  <span class="k">if</span> <span class="p">(</span><span class="n">velocityIsAboveThreshold</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">threshold</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">velocity</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Calculates the angular displacement, depending on the direction of rotation.</span>
<span class="c1">// Our step motors are 200step motors. (Take 200 steps to rotate 360 degrees).</span>
<span class="c1">// With each step being 1.8degrees and our velocities being relatively slow, w ecan</span>
<span class="c1">// estimate our angular displacement per step as -1.8 || +1.8 dgerees.</span>
<span class="c1">// Positive angular velocity (CCW) +1.8 == +0.0314159</span>
<span class="c1">// Negative angular velocity (CW) -1.8 == -0.0314159</span>
<span class="c1">// If velocity is zero (ie scenarios where vleocity is below threshold), a &#39;0&#39; is</span>
<span class="c1">// returned for no angular displacement.</span>
<span class="kt">float</span> <span class="nf">getAngularDisplacement</span><span class="p">(</span><span class="kt">float</span> <span class="n">velocity</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">velocity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mf">0.0314159</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">velocity</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.0314159</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span> 
<span class="p">}</span>

<span class="c1">// Sends step command to the motors.</span>
<span class="c1">// Takes threhsold into consideration. If desired velocity is &#39;0&#39; (ie like when below threshold),</span>
<span class="c1">// then no step is issued. No need to send a step command if the velocity is zero.</span>
<span class="c1">// This takes positive/negative signs into consideration. If desired velocity is</span>
<span class="c1">// Positive angular velocity (CCW) == BACKWARD</span>
<span class="c1">// Negative angular velocity (CW) == FORWARD</span>
<span class="c1">// Step command is below:</span>
<span class="c1">// motorArray[motorNumber]-&gt;step(#OfSteps, DIRECTION, stepTYPE)</span>
<span class="kt">void</span> <span class="nf">motorStep</span><span class="p">(</span><span class="kt">float</span> <span class="n">motorVel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">motorNumber</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">velocityIsAboveThreshold</span><span class="p">(</span><span class="n">motorVel</span><span class="p">,</span> <span class="n">velocityThreshold</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">motorVel</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">motorArray</span><span class="p">[</span><span class="n">motorNumber</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">step</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BACKWARD</span><span class="p">,</span> <span class="n">DOUBLE</span><span class="p">);</span> <span class="c1">// clockwise</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">motorArray</span><span class="p">[</span><span class="n">motorNumber</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">step</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">FORWARD</span><span class="p">,</span> <span class="n">DOUBLE</span><span class="p">);</span> <span class="c1">// counter-clockwise</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Initializes the publishers that report our current velocities and </span>
<span class="c1">// angular displacmeents to the Pi.</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">currentMotorVelocities_topic</span><span class="p">(</span><span class="s">&quot;currentMotorVelocities_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">currentVelocities</span><span class="p">);</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">angularDisplacements_topic</span><span class="p">(</span><span class="s">&quot;angularDisplacements_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">angularDisplacements</span><span class="p">);</span>

<span class="c1">// Assigns the velocities from our currently desired values to our</span>
<span class="c1">// custom motorArray msg object.</span>
<span class="kt">void</span> <span class="nf">publishCurrentMotorVelocities</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor1</span> <span class="o">=</span> <span class="n">getCurrentMotorVelocity</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">velocityThreshold</span><span class="p">);</span>
  <span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor2</span> <span class="o">=</span> <span class="n">getCurrentMotorVelocity</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">velocityThreshold</span><span class="p">);</span>
  <span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor3</span> <span class="o">=</span> <span class="n">getCurrentMotorVelocity</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">velocityThreshold</span><span class="p">);</span>

  <span class="n">currentMotorVelocities_topic</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">currentVelocities</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Assigns the angular displacement (WRT our current iteration&#39;s velocity) toour</span>
<span class="c1">// custom motorArray msg object.</span>
<span class="kt">void</span> <span class="nf">publishAngularDisplacements</span><span class="p">()</span>
<span class="p">{</span> 
  <span class="n">angularDisplacements</span><span class="p">.</span><span class="n">motor1</span> <span class="o">=</span> <span class="n">getAngularDisplacement</span><span class="p">(</span><span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor1</span><span class="p">);</span>
  <span class="n">angularDisplacements</span><span class="p">.</span><span class="n">motor2</span> <span class="o">=</span> <span class="n">getAngularDisplacement</span><span class="p">(</span><span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor2</span><span class="p">);</span>
  <span class="n">angularDisplacements</span><span class="p">.</span><span class="n">motor3</span> <span class="o">=</span> <span class="n">getAngularDisplacement</span><span class="p">(</span><span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor3</span><span class="p">);</span>

  <span class="n">angularDisplacements_topic</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">angularDisplacements</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Set up motorVelocities subscriber</span>
<span class="c1">// The velocity for each stepMotor is declared inside of a custom motorArray ROS msg</span>
<span class="c1">// and is recioeved through the &#39;setStepMotorVelocity_topic&#39;.</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="o">&lt;</span><span class="n">omnibot</span><span class="o">::</span><span class="n">MotorArray</span><span class="o">&gt;</span> <span class="n">motorVelocities</span><span class="p">(</span><span class="s">&quot;setStepMotorVelocity_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">updateMotorVelocities</span> <span class="p">);</span>

<span class="c1">// Iterates through the stepMotor array and performs the step command (if applicable).</span>
<span class="kt">void</span> <span class="nf">activateMotors</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">motorStep</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set baud rate</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">initNode</span><span class="p">();</span> <span class="c1">// Initialize ROSserial node</span>

  <span class="c1">// notify master of our new publishers and subscribers</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">motorVelocities</span><span class="p">);</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="n">currentMotorVelocities_topic</span><span class="p">);</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="n">angularDisplacements_topic</span><span class="p">);</span>

  <span class="n">AFMSbot</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="c1">// Initialize the bottom shield</span>
  <span class="n">AFMStop</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="c1">// Initialize the top shield</span>

  <span class="c1">// add motor instances to our motorArray</span>
  <span class="c1">// ommited index=0 for clarity</span>
  <span class="n">motorArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stepMotor_1</span><span class="p">;</span>
  <span class="n">motorArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">stepMotor_2</span><span class="p">;</span>
  <span class="n">motorArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">stepMotor_3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// This causes ROS to cycle.</span>
  <span class="c1">// Normally (on a multithreaded device) each subscriber</span>
  <span class="c1">// works in its own thread. Because this device is </span>
  <span class="c1">// single threaded, this function aids in protothreading and making</span>
  <span class="c1">// sure our values are updated accordingly.</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">spinOnce</span><span class="p">();</span>

  <span class="c1">// Processes current desired velocities and sends the </span>
  <span class="n">activateMotors</span><span class="p">();</span>

  <span class="c1">// step commands ot the motors// Publishes currrent motor velocities to &#39;currentMotorVelocities_topic&#39;.</span>
  <span class="n">publishCurrentMotorVelocities</span><span class="p">();</span>  
  <span class="c1">// Publishes the angular displacement for the current iteration to &#39;angularDisplacements_topic&#39;.</span>
  <span class="n">publishAngularDisplacements</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="sensors-only-w-ros">Sensors Only (w/ ROS)</h3>
<p>'scripts/arduino/basicSensors_wROS.ino'</p>
<p>Begins reading data from arudino's onboard accelerometer and gyroscope. ROS is used to publish linear acceleration, orientation, and angular velocity. External power source not needed (only USB). No subscribers.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191</pre></div></td><td class="code"><div class="codehilite"><pre><span class="cp">#include &lt;ros.h&gt; </span><span class="c1">// ROS library</span>
<span class="cp">#include &lt;CurieIMU.h&gt; </span><span class="c1">// accelerometer library</span>
<span class="cp">#include &lt;MadgwickAHRS.h&gt; </span><span class="c1">// noise filter library</span>
<span class="cp">#include &lt;geometry_msgs/Vector3.h&gt; </span><span class="c1">// ROS messages library</span>

<span class="c1">// Instantiate ROS handler object.</span>
<span class="c1">// (this makes it a ROS node)</span>
<span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span> 

<span class="c1">// preallocate Vector3 variables to hold:</span>
<span class="c1">// --------------------------------------</span>
<span class="c1">// var orientation = orientation </span>
<span class="c1">// var linearAccel = linear acceleration</span>
<span class="c1">// var angularVel = angular velocity</span>
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">Vector3</span> <span class="n">orientation</span><span class="p">;</span> 
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">Vector3</span> <span class="n">linearAccel</span><span class="p">;</span>
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">Vector3</span> <span class="n">angularVel</span><span class="p">;</span>

<span class="c1">// Set up publishers for each of the variables above.</span>
<span class="c1">// Each of these publishers will publish each of the variables above,</span>
<span class="c1">// every time the arduino loop executes (activated by the &quot;spinOnce&quot; on line 141).</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">orientation_topic</span><span class="p">(</span><span class="s">&quot;orientation_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">orientation</span><span class="p">);</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">linearAccel_topic</span><span class="p">(</span><span class="s">&quot;linearAccel_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">linearAccel</span><span class="p">);</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">angularVel_topic</span><span class="p">(</span><span class="s">&quot;angularVel_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">angularVel</span><span class="p">);</span>

<span class="c1">// Create a Madgwick object to access the functions from the </span>
<span class="c1">// Madgwick class in the library. Here, we call it filter.</span>
<span class="c1">// A prewritten class from ADAFRUIT website that will allow </span>
<span class="c1">// us to get a reading from the onboard gyroscope and accelerometer.</span>
<span class="c1">// https://www.arduino.cc/en/Tutorial/Genuino101CurieIMUOrientationVisualiser</span>
<span class="n">Madgwick</span> <span class="n">filter</span><span class="p">;</span>

<span class="c1">// initialize sensor data variables</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">microsPerReading</span><span class="p">,</span> <span class="n">microsPrevious</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">accelScale</span><span class="p">,</span> <span class="n">gyroScale</span><span class="p">;</span>

<span class="c1">// The algorithm takes raw values from a gyroscope and accelerometer, </span>
<span class="c1">// and uses them to return four quaternions:</span>

<span class="kt">int</span> <span class="n">aix</span><span class="p">,</span> <span class="n">aiy</span><span class="p">,</span> <span class="n">aiz</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">gix</span><span class="p">,</span> <span class="n">giy</span><span class="p">,</span> <span class="n">giz</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span><span class="p">;</span>

<span class="c1">// which are 4-dimensional numbers which contain x, y, and z values to </span>
<span class="c1">// represent the axis around which rotation occurs, as well as a  value</span>
<span class="c1">// which represents the value of rotation which occurs around the same </span>
<span class="c1">// axis. These quaternions can be used to calculate the Euler angles </span>
<span class="c1">// pitch, yaw, and roll.</span>

<span class="kt">float</span> <span class="n">roll</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">heading</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">microsNow</span><span class="p">;</span>

<span class="c1">// Helper functions for translating quarternion readings.</span>
<span class="c1">// Both are used in &#39;publishLinearAccelAndangularVel()&#39;</span>
<span class="kt">float</span> <span class="nf">convertRawAcceleration</span><span class="p">(</span><span class="kt">int</span> <span class="n">aRaw</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// since we are using 2G range</span>
  <span class="c1">// -2g maps to a raw value of -32768</span>
  <span class="c1">// +2g maps to a raw value of 32767</span>

  <span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">aRaw</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">32768.0</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">float</span> <span class="nf">convertRawGyro</span><span class="p">(</span><span class="kt">int</span> <span class="n">gRaw</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// since we are using 250 degrees/seconds range</span>
  <span class="c1">// -250 maps to a raw value of -32768</span>
  <span class="c1">// +250 maps to a raw value of 32767</span>

  <span class="kt">float</span> <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">gRaw</span> <span class="o">*</span> <span class="mf">250.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">32768.0</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">g</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// This function takes care of three different tasks</span>
<span class="c1">// 1) Translatemrat raw quarternion readings to:</span>
<span class="c1">//    -Gs for linear accelration (line )</span>
<span class="c1">//    -Degrees/sec for angular velocity</span>
<span class="c1">// 2) Publish tranlated motion values to their respective topics</span>
<span class="c1">// 3) Update the the Madgwick object (the filter) to later obtain </span>
<span class="c1">//    our roll, pitch, and yaw</span>
<span class="kt">void</span> <span class="nf">publishLinearAccelAndangularVel</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// convert from raw data to gravity and degrees/second units</span>
  <span class="n">ax</span> <span class="o">=</span> <span class="n">convertRawAcceleration</span><span class="p">(</span><span class="n">aix</span><span class="p">);</span>
  <span class="n">ay</span> <span class="o">=</span> <span class="n">convertRawAcceleration</span><span class="p">(</span><span class="n">aiy</span><span class="p">);</span>
  <span class="n">az</span> <span class="o">=</span> <span class="n">convertRawAcceleration</span><span class="p">(</span><span class="n">aiz</span><span class="p">);</span>
  <span class="n">gx</span> <span class="o">=</span> <span class="n">convertRawGyro</span><span class="p">(</span><span class="n">gix</span><span class="p">);</span>
  <span class="n">gy</span> <span class="o">=</span> <span class="n">convertRawGyro</span><span class="p">(</span><span class="n">giy</span><span class="p">);</span>
  <span class="n">gz</span> <span class="o">=</span> <span class="n">convertRawGyro</span><span class="p">(</span><span class="n">giz</span><span class="p">);</span>

  <span class="c1">// update the filter, which computes orientation</span>
  <span class="c1">// we will call this filter in a separata function to get roll, pitch, yaw</span>
  <span class="n">filter</span><span class="p">.</span><span class="n">updateIMU</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span><span class="p">);</span>

  <span class="c1">// attach linear accel and rotational vel values for publishing</span>
  <span class="n">linearAccel</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ax</span><span class="p">;</span>
  <span class="n">linearAccel</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ay</span><span class="p">;</span>
  <span class="n">linearAccel</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">az</span><span class="p">;</span>
  <span class="n">angularVel</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">gx</span><span class="p">;</span>
  <span class="n">angularVel</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">gy</span><span class="p">;</span>
  <span class="n">angularVel</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">gz</span><span class="p">;</span>

  <span class="c1">// publish values</span>
  <span class="n">linearAccel_topic</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">linearAccel</span> <span class="p">);</span>
  <span class="n">angularVel_topic</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">angularVel</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Retrieves roll, pitch, and yaw from the filter (Madgqiwck object)</span>
<span class="c1">// and publishes it to the orientation topic.</span>
<span class="c1">// Roll, pitch, and yaw are calculated according to the update performed on the filter </span>
<span class="c1">// from &#39;publishLinearAccelAndangularVel()&#39; function (runs beforehand).</span>
<span class="kt">void</span> <span class="nf">publishOrientation</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">roll</span> <span class="o">=</span> <span class="n">filter</span><span class="p">.</span><span class="n">getRoll</span><span class="p">();</span>
  <span class="n">pitch</span> <span class="o">=</span> <span class="n">filter</span><span class="p">.</span><span class="n">getPitch</span><span class="p">();</span>
  <span class="n">heading</span> <span class="o">=</span> <span class="n">filter</span><span class="p">.</span><span class="n">getYaw</span><span class="p">();</span>

  <span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">roll</span><span class="p">;</span>
  <span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">;</span>
  <span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">heading</span><span class="p">;</span>

  <span class="n">orientation_topic</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">orientation</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Checks to ensure its time to take a new reading, according to timestep defined</span>
<span class="c1">// inside of the &#39;setup()&#39; function.</span>
<span class="c1">// If its time for a reading, linearAcceleration, angularVelocity,a nd orientation are</span>
<span class="c1">// all read and published.</span>
<span class="kt">void</span> <span class="nf">processAndPublishSensorData</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Timestep is calculated below.</span>
  <span class="c1">// Configuration for the itme step is set in the &#39;setup()&#39; function.</span>
  <span class="n">microsNow</span> <span class="o">=</span> <span class="n">micros</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">microsNow</span> <span class="o">-</span> <span class="n">microsPrevious</span> <span class="o">&gt;=</span> <span class="n">microsPerReading</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// read raw data from CurieIMU and store in &#39;aix, aiy, aiz, gix, giy, giz&#39;</span>
    <span class="c1">// These variables are available globally!</span>
    <span class="n">CurieIMU</span><span class="p">.</span><span class="n">readMotionSensor</span><span class="p">(</span><span class="n">aix</span><span class="p">,</span> <span class="n">aiy</span><span class="p">,</span> <span class="n">aiz</span><span class="p">,</span> <span class="n">gix</span><span class="p">,</span> <span class="n">giy</span><span class="p">,</span> <span class="n">giz</span><span class="p">);</span>

    <span class="n">publishLinearAccelAndangularVel</span><span class="p">();</span>
    <span class="n">publishOrientation</span><span class="p">();</span>

    <span class="c1">// increment previous time, so we keep proper pace</span>
    <span class="n">microsPrevious</span> <span class="o">=</span> <span class="n">microsPrevious</span> <span class="o">+</span> <span class="n">microsPerReading</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Set baud rate for serial transmission.</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> 
  <span class="c1">// Initilizes the ROS node.</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">initNode</span><span class="p">();</span>  

  <span class="c1">// Notify the master node that we have 3 publishers declared above.</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="n">orientation_topic</span><span class="p">);</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="n">linearAccel_topic</span><span class="p">);</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="n">angularVel_topic</span><span class="p">);</span>

  <span class="c1">// Start the IMU and perform preliminary configuration by </span>
  <span class="c1">// setting the sample rate of the acelerometer and the gyro </span>
  <span class="c1">// and the filter to 25Hz:</span>
  <span class="n">CurieIMU</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">CurieIMU</span><span class="p">.</span><span class="n">setGyroRate</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span> <span class="c1">//25 Hz</span>
  <span class="n">CurieIMU</span><span class="p">.</span><span class="n">setAccelerometerRate</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span> <span class="c1">// 25Hz</span>
  <span class="n">filter</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span> <span class="c1">// 25Hz</span>

  <span class="c1">// Set the accelerometer range to 2G</span>
  <span class="n">CurieIMU</span><span class="p">.</span><span class="n">setAccelerometerRange</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

  <span class="c1">// Set the gyroscope range to 250 degrees/second</span>
  <span class="n">CurieIMU</span><span class="p">.</span><span class="n">setGyroRange</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>

  <span class="c1">// initialize variables to pace updates to correct rate</span>
  <span class="n">microsPerReading</span> <span class="o">=</span> <span class="mi">1000000</span> <span class="o">/</span> <span class="mi">25</span><span class="p">;</span>
  <span class="n">microsPrevious</span> <span class="o">=</span> <span class="n">micros</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// This causes ROS to cycle.</span>
  <span class="c1">// Normally (on a multithreaded device) each subscriber</span>
  <span class="c1">// works in its own thread. Because this device is </span>
  <span class="c1">// single threaded, this function aids in protothreading and making</span>
  <span class="c1">// sure our values are updated accordingly.</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">spinOnce</span><span class="p">();</span>

  <span class="c1">// This line processes all other functions, preparing and publishing </span>
  <span class="c1">// all outgoing data.</span>
  <span class="n">processAndPublishSensorData</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="motors-sensors-w-ros">Motors + Sensors (w/ ROS)</h3>
<p>'scripts/arduino/motorsAndSensors_wROS.ino'</p>
<p>Starts up three motors and onboard accelerometer/gyroscope.
Subscribes to velocity updates.
Publishes angular dispacmeents, motor velocities, orientation, linear acceleration, and angular velocity.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c1">// =================================================</span>
<span class="c1">// Motor Libraries [START] -------------------------</span>
<span class="cp">#include &lt;Wire.h&gt;</span>
<span class="cp">#include &lt;Adafruit_MotorShield.h&gt;</span>
<span class="cp">#include &lt;ros.h&gt;</span>
<span class="cp">#include &lt;std_msgs/Int64.h&gt;</span>
<span class="cp">#include &lt;std_msgs/Float32MultiArray.h&gt;</span>
<span class="cp">#include &lt;geometry_msgs/Point.h&gt;</span>
<span class="cp">#include &lt;omnibot/MotorArray.h&gt;</span>
<span class="c1">// Motor Libraries [END] ---------------------------</span>
<span class="c1">// =================================================</span>
<span class="c1">// =================================================</span>
<span class="c1">// Sensor Libraries [START] ------------------------</span>
<span class="cp">#include &lt;CurieIMU.h&gt;</span>
<span class="cp">#include &lt;MadgwickAHRS.h&gt;</span>
<span class="cp">#include &lt;geometry_msgs/Vector3.h&gt;</span>
<span class="c1">// Sensor Libraries [END] --------------------------</span>
<span class="c1">// =================================================</span>

<span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span>

<span class="c1">// ==============================================================</span>
<span class="c1">// Motor variable declaration [START]----------------------------</span>
<span class="n">Adafruit_MotorShield</span> <span class="nf">AFMStop</span><span class="p">(</span><span class="mh">0x61</span><span class="p">);</span>
<span class="n">Adafruit_MotorShield</span> <span class="nf">AFMSbot</span><span class="p">(</span><span class="mh">0x60</span><span class="p">);</span>

<span class="n">Adafruit_StepperMotor</span> <span class="o">*</span><span class="n">stepMotor_1</span> <span class="o">=</span> <span class="n">AFMStop</span><span class="p">.</span><span class="n">getStepper</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">Adafruit_StepperMotor</span> <span class="o">*</span><span class="n">stepMotor_2</span> <span class="o">=</span> <span class="n">AFMSbot</span><span class="p">.</span><span class="n">getStepper</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">Adafruit_StepperMotor</span> <span class="o">*</span><span class="n">stepMotor_3</span> <span class="o">=</span> <span class="n">AFMSbot</span><span class="p">.</span><span class="n">getStepper</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="n">Adafruit_StepperMotor</span><span class="o">*</span> <span class="n">motorArray</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="kt">float</span> <span class="n">velocityArray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span> <span class="c1">// initialize motors at angular_vel=0; available globally</span>
<span class="kt">float</span> <span class="n">velocityThreshold</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="n">omnibot</span><span class="o">::</span><span class="n">MotorArray</span> <span class="n">currentVelocities</span><span class="p">;</span>
<span class="n">omnibot</span><span class="o">::</span><span class="n">MotorArray</span> <span class="n">angularDisplacements</span><span class="p">;</span>

<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">currentMotorVelocities_topic</span><span class="p">(</span><span class="s">&quot;currentMotorVelocities_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">currentVelocities</span><span class="p">);</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">angularDisplacements_topic</span><span class="p">(</span><span class="s">&quot;angularDisplacements_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">angularDisplacements</span><span class="p">);</span>
<span class="c1">// Motor variable declaration [END]------------------------------</span>
<span class="c1">// ==============================================================</span>

<span class="c1">// ==============================================================</span>
<span class="c1">// Sensor variable declaration [START]----------------------------</span>
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">Vector3</span> <span class="n">orientation</span><span class="p">;</span>
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">Vector3</span> <span class="n">linearAccel</span><span class="p">;</span>
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">Vector3</span> <span class="n">angularVel</span><span class="p">;</span>

<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">linearAccel_topic</span><span class="p">(</span><span class="s">&quot;linearAccel_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">linearAccel</span><span class="p">);</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">angularVel_topic</span><span class="p">(</span><span class="s">&quot;angularVel_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">angularVel</span><span class="p">);</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">orientation_topic</span><span class="p">(</span><span class="s">&quot;orientation_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">orientation</span><span class="p">);</span>

<span class="n">Madgwick</span> <span class="n">filter</span><span class="p">;</span>

<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">microsPerReading</span><span class="p">,</span> <span class="n">microsPrevious</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">accelScale</span><span class="p">,</span> <span class="n">gyroScale</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">aix</span><span class="p">,</span> <span class="n">aiy</span><span class="p">,</span> <span class="n">aiz</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">gix</span><span class="p">,</span> <span class="n">giy</span><span class="p">,</span> <span class="n">giz</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">roll</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">heading</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">microsNow</span><span class="p">;</span>
<span class="c1">// Sensor variable declaration [END]------------------------------</span>
<span class="c1">// ==============================================================</span>

<span class="c1">// ==============================================================</span>
<span class="c1">// Motor function and callbacks [START]--------------------------</span>
<span class="c1">// callback function for subscriber below. Updates velocities from FIFO queue</span>
<span class="kt">void</span> <span class="nf">updateMotorVelocities</span><span class="p">(</span> <span class="k">const</span> <span class="n">omnibot</span><span class="o">::</span><span class="n">MotorArray</span><span class="o">&amp;</span> <span class="n">velocity_msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">velocityArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocity_msg</span><span class="p">.</span><span class="n">motor1</span><span class="p">;</span> <span class="n">velocityArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocity_msg</span><span class="p">.</span><span class="n">motor2</span><span class="p">;</span> <span class="n">velocityArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocity_msg</span><span class="p">.</span><span class="n">motor3</span><span class="p">;</span>

  <span class="n">motorArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
  <span class="n">motorArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
  <span class="n">motorArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]));</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">velocityIsAboveThreshold</span><span class="p">(</span><span class="kt">float</span> <span class="n">motorVel</span><span class="p">,</span> <span class="kt">float</span> <span class="n">threshold</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">motorVel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">getCurrentMotorVelocity</span><span class="p">(</span><span class="kt">float</span> <span class="n">velocity</span><span class="p">,</span> <span class="kt">float</span> <span class="n">threshold</span><span class="p">)</span>
<span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">velocityIsAboveThreshold</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">threshold</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">velocity</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">getAngularDisplacement</span><span class="p">(</span><span class="kt">float</span> <span class="n">velocity</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">velocity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mf">0.0314159</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">velocity</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.0314159</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span> 
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">motorStep</span><span class="p">(</span><span class="kt">float</span> <span class="n">motorVel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">motorNumber</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">velocityIsAboveThreshold</span><span class="p">(</span><span class="n">motorVel</span><span class="p">,</span> <span class="n">velocityThreshold</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">motorVel</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">motorArray</span><span class="p">[</span><span class="n">motorNumber</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">step</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BACKWARD</span><span class="p">,</span> <span class="n">DOUBLE</span><span class="p">);</span> <span class="c1">// clockwise</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">motorArray</span><span class="p">[</span><span class="n">motorNumber</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">step</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">FORWARD</span><span class="p">,</span> <span class="n">DOUBLE</span><span class="p">);</span> <span class="c1">// counter-clockwise</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">publishCurrentMotorVelocities</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor1</span> <span class="o">=</span> <span class="n">getCurrentMotorVelocity</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">velocityThreshold</span><span class="p">);</span>
  <span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor2</span> <span class="o">=</span> <span class="n">getCurrentMotorVelocity</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">velocityThreshold</span><span class="p">);</span>
  <span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor3</span> <span class="o">=</span> <span class="n">getCurrentMotorVelocity</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">velocityThreshold</span><span class="p">);</span>

  <span class="n">currentMotorVelocities_topic</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">currentVelocities</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">publishAngularDisplacements</span><span class="p">()</span>
<span class="p">{</span> 
  <span class="n">angularDisplacements</span><span class="p">.</span><span class="n">motor1</span> <span class="o">=</span> <span class="n">getAngularDisplacement</span><span class="p">(</span><span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor1</span><span class="p">);</span>
  <span class="n">angularDisplacements</span><span class="p">.</span><span class="n">motor2</span> <span class="o">=</span> <span class="n">getAngularDisplacement</span><span class="p">(</span><span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor2</span><span class="p">);</span>
  <span class="n">angularDisplacements</span><span class="p">.</span><span class="n">motor3</span> <span class="o">=</span> <span class="n">getAngularDisplacement</span><span class="p">(</span><span class="n">currentVelocities</span><span class="p">.</span><span class="n">motor3</span><span class="p">);</span>

  <span class="n">angularDisplacements_topic</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">angularDisplacements</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Set up motorVelocities subscriber</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="o">&lt;</span><span class="n">omnibot</span><span class="o">::</span><span class="n">MotorArray</span><span class="o">&gt;</span> <span class="n">motorVelocities</span><span class="p">(</span><span class="s">&quot;setStepMotorVelocity_topic&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">updateMotorVelocities</span> <span class="p">);</span>

<span class="kt">void</span> <span class="nf">activateMotors</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">motorStep</span><span class="p">(</span><span class="n">velocityArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Motor function and callbacks [END]----------------------------</span>
<span class="c1">// ==============================================================</span>

<span class="c1">// ==============================================================</span>
<span class="c1">// Sensor function and callbacks [START]--------------------------</span>
<span class="kt">float</span> <span class="nf">convertRawAcceleration</span><span class="p">(</span><span class="kt">int</span> <span class="n">aRaw</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// since we are using 2G range</span>
  <span class="c1">// -2g maps to a raw value of -32768</span>
  <span class="c1">// +2g maps to a raw value of 32767</span>

  <span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">aRaw</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">32768.0</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">convertRawGyro</span><span class="p">(</span><span class="kt">int</span> <span class="n">gRaw</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// since we are using 250 degrees/seconds range</span>
  <span class="c1">// -250 maps to a raw value of -32768</span>
  <span class="c1">// +250 maps to a raw value of 32767</span>

  <span class="kt">float</span> <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">gRaw</span> <span class="o">*</span> <span class="mf">250.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">32768.0</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">g</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">publishLinearAndangularVel</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">ax</span> <span class="o">=</span> <span class="n">convertRawAcceleration</span><span class="p">(</span><span class="n">aix</span><span class="p">);</span>
  <span class="n">ay</span> <span class="o">=</span> <span class="n">convertRawAcceleration</span><span class="p">(</span><span class="n">aiy</span><span class="p">);</span>
  <span class="n">az</span> <span class="o">=</span> <span class="n">convertRawAcceleration</span><span class="p">(</span><span class="n">aiz</span><span class="p">);</span>

  <span class="n">gx</span> <span class="o">=</span> <span class="n">convertRawGyro</span><span class="p">(</span><span class="n">gix</span><span class="p">);</span>
  <span class="n">gy</span> <span class="o">=</span> <span class="n">convertRawGyro</span><span class="p">(</span><span class="n">giy</span><span class="p">);</span>
  <span class="n">gz</span> <span class="o">=</span> <span class="n">convertRawGyro</span><span class="p">(</span><span class="n">giz</span><span class="p">);</span>

  <span class="n">filter</span><span class="p">.</span><span class="n">updateIMU</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span><span class="p">);</span>

  <span class="n">linearAccel</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">ax</span><span class="p">;</span>
  <span class="n">linearAccel</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ay</span><span class="p">;</span>
  <span class="n">linearAccel</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">az</span><span class="p">;</span>

  <span class="n">angularVel</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">gx</span><span class="p">;</span>
  <span class="n">angularVel</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">gy</span><span class="p">;</span>
  <span class="n">angularVel</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">gz</span><span class="p">;</span>

  <span class="n">linearAccel_topic</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">linearAccel</span> <span class="p">);</span>
  <span class="n">angularVel_topic</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">angularVel</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">publishOrientation</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">roll</span> <span class="o">=</span> <span class="n">filter</span><span class="p">.</span><span class="n">getRoll</span><span class="p">();</span>
  <span class="n">pitch</span> <span class="o">=</span> <span class="n">filter</span><span class="p">.</span><span class="n">getPitch</span><span class="p">();</span>
  <span class="n">heading</span> <span class="o">=</span> <span class="n">filter</span><span class="p">.</span><span class="n">getYaw</span><span class="p">();</span>

  <span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">roll</span><span class="p">;</span>
  <span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">;</span>
  <span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">heading</span><span class="p">;</span>

  <span class="n">orientation_topic</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">orientation</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">processAndPublishSensorData</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">microsNow</span> <span class="o">=</span> <span class="n">micros</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">microsNow</span> <span class="o">-</span> <span class="n">microsPrevious</span> <span class="o">&gt;=</span> <span class="n">microsPerReading</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// read raw data from CurieIMU</span>
    <span class="n">CurieIMU</span><span class="p">.</span><span class="n">readMotionSensor</span><span class="p">(</span><span class="n">aix</span><span class="p">,</span> <span class="n">aiy</span><span class="p">,</span> <span class="n">aiz</span><span class="p">,</span> <span class="n">gix</span><span class="p">,</span> <span class="n">giy</span><span class="p">,</span> <span class="n">giz</span><span class="p">);</span>

    <span class="n">publishLinearAndangularVel</span><span class="p">();</span>
    <span class="n">publishOrientation</span><span class="p">();</span>

    <span class="c1">// increment previous time, so we keep proper pace</span>
    <span class="n">microsPrevious</span> <span class="o">=</span> <span class="n">microsPrevious</span> <span class="o">+</span> <span class="n">microsPerReading</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Sensor function and callbacks [END]----------------------------</span>
<span class="c1">// ==============================================================</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set baud rate</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">initNode</span><span class="p">();</span>

  <span class="c1">// =============================================</span>
  <span class="c1">// Motor setup [START]--------------------------</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">motorVelocities</span><span class="p">);</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="n">currentMotorVelocities_topic</span><span class="p">);</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="n">angularDisplacements_topic</span><span class="p">);</span>

  <span class="n">AFMSbot</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">AFMStop</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>

  <span class="n">motorArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stepMotor_1</span><span class="p">;</span>
  <span class="n">motorArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">stepMotor_2</span><span class="p">;</span>
  <span class="n">motorArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">stepMotor_3</span><span class="p">;</span>
  <span class="c1">// Motor setup [END]--------------------------</span>
  <span class="c1">// ===========================================</span>

  <span class="c1">// =============================================</span>
  <span class="c1">// Sensor setup [START]--------------------------</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="n">orientation_topic</span><span class="p">);</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="n">linearAccel_topic</span><span class="p">);</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="n">angularVel_topic</span><span class="p">);</span>

  <span class="n">CurieIMU</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">CurieIMU</span><span class="p">.</span><span class="n">setGyroRate</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
  <span class="n">CurieIMU</span><span class="p">.</span><span class="n">setAccelerometerRate</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
  <span class="n">filter</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>

  <span class="n">CurieIMU</span><span class="p">.</span><span class="n">setAccelerometerRange</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">CurieIMU</span><span class="p">.</span><span class="n">setGyroRange</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>

  <span class="n">microsPerReading</span> <span class="o">=</span> <span class="mi">1000000</span> <span class="o">/</span> <span class="mi">25</span><span class="p">;</span>
  <span class="n">microsPrevious</span> <span class="o">=</span> <span class="n">micros</span><span class="p">();</span>
  <span class="c1">// Sensor setup [END]--------------------------</span>
  <span class="c1">// ===========================================</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">nh</span><span class="p">.</span><span class="n">spinOnce</span><span class="p">();</span>
  <span class="c1">// ====================================================</span>
  <span class="c1">// Motor loop [START]----------------------------------</span>
  <span class="n">activateMotors</span><span class="p">();</span>
  <span class="n">publishCurrentMotorVelocities</span><span class="p">();</span>
  <span class="n">publishAngularDisplacements</span><span class="p">();</span>
  <span class="c1">// Motor loop [END]----------------------------------</span>
  <span class="c1">// ====================================================</span>
  <span class="c1">// ====================================================</span>
  <span class="c1">// Sensor loop [START]----------------------------------</span>
  <span class="n">processAndPublishSensorData</span><span class="p">();</span>
  <span class="c1">// Sensor loop [END]----------------------------------</span>
  <span class="c1">// ====================================================</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="script-files-dev-only">Script Files (Dev Only)</h2>
<h3 id="velocity-publisher-node">Velocity Publisher Node</h3>
<p>'scripts/velocityPublisher_node.py'</p>
<p>Sets up motor velocities at 100 rpms each.
Begins decreasing velocity at 1rpm per cycle (1 second)
Motors will chnage direction, when velocities become negative.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">rospy</span> <span class="c">#import ROS pip package for using ROS library</span>
<span class="kn">from</span> <span class="nn">omnibot.msg</span> <span class="kn">import</span> <span class="n">MotorArray</span> <span class="c"># import our custom ROS msg types</span>

<span class="k">def</span> <span class="nf">VelocityPublisher_talker</span><span class="p">():</span>
    <span class="c"># Declare publisher</span>
    <span class="c"># Transmitting to =&gt; setStepMotorVelocity_topic</span>
    <span class="c"># Using the &#39;MotorArray&#39; message type</span>
    <span class="c"># A maximnum of 10 messages will be held in the message queue.</span>
    <span class="n">pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s">&#39;setStepMotorVelocity_topic&#39;</span><span class="p">,</span> <span class="n">MotorArray</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c"># Initialize node</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s">&#39;velocityPublisher_node&#39;</span><span class="p">)</span>

    <span class="c"># Sets ROS to cycle at frequency of 1Hz</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 

    <span class="c"># Set uinitial velocity to 100 rpms</span>
    <span class="n">velocity</span><span class="o">=</span><span class="mf">100.00</span>

    <span class="c"># This keeps the node running until the script is shut down manually.</span>
    <span class="c"># node will keep cycling at the frequncy set above.</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span> 
        <span class="c"># Velocity decreases by 1 rpm every cycle</span>
        <span class="n">velocity</span> <span class="o">-=</span> <span class="mf">1.0</span>
        <span class="c"># Logs our MotorArray to the terminal</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">([</span><span class="n">velocity</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">velocity</span><span class="p">])</span>
        <span class="c"># Publishes our motorArray to the &#39;setStepMotorVelocity_topic&#39;</span>
        <span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">velocity</span><span class="p">)</span>
        <span class="c"># Causes the while loop to pause until its time to cycle again.</span>
        <span class="c"># How long it sleeps (pauses) depends on our declared frequnecy above.</span>
        <span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">VelocityPublisher_talker</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</td></tr></table>

<h3 id="velocity-publisher-node-1">Velocity Publisher Node 1</h3>
<p>'scripts/velocityPublisher_node_1.py'</p>
<p>Starts the motors at 30 rpm.
Causes the motors to alternate directions every 5 seconds.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">from</span> <span class="nn">omnibot.msg</span> <span class="kn">import</span> <span class="n">MotorArray</span>

<span class="c"># Starts the motors at 30 rpm.</span>
<span class="c"># Causes the motors to alternate directions every 5 seconds.</span>

<span class="k">def</span> <span class="nf">VelocityPublisher_talker</span><span class="p">():</span>
    <span class="n">pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s">&#39;setStepMotorVelocity_topic&#39;</span><span class="p">,</span> <span class="n">MotorArray</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s">&#39;velocityPublisher_node&#39;</span><span class="p">)</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">velocity</span> <span class="o">=</span> <span class="mf">30.00</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
        <span class="n">velocity</span> <span class="o">=</span> <span class="n">velocity</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
        <span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">velocity</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">VelocityPublisher_talker</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</td></tr></table>

<h3 id="velocity-publisher-node-2">Velocity Publisher Node 2</h3>
<p>'scripts/velocityPublisher_node_2.py'</p>
<p>Displays both directions for each motor in the following order.
Velocities in either direction ar set to 30 rpm.
Scenarios alternate every 5 seconds.</p>
<p>Set -&gt; 1
Motor1 = CCW; Motor2 = CCW; Motor3= CCW</p>
<p>Set -&gt; 2
Motor1 = 0; Motor2 = 0; Motor3= 0</p>
<p>Set -&gt; 3
Motor1 = CW; Motor2 = CW; Motor3= CW</p>
<p>Set -&gt; 4
Motor1 = CCW; Motor2 = 0; Motor3= CW</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">from</span> <span class="nn">omnibot.msg</span> <span class="kn">import</span> <span class="n">MotorArray</span>

<span class="c"># Displays both directions for each motor in the following order.</span>
<span class="c"># Velocities in either direction ar set to 30 rpm.</span>
<span class="c"># Scenarios alternate every 5 seconds.</span>

<span class="c"># Set -&gt; 1</span>
<span class="c"># Motor1 = CCW; Motor2 = CCW; Motor3= CCW</span>

<span class="c"># Set -&gt; 2</span>
<span class="c"># Motor1 = 0; Motor2 = 0; Motor3= 0</span>

<span class="c"># Set -&gt; 3</span>
<span class="c"># Motor1 = CW; Motor2 = CW; Motor3= CW</span>

<span class="c"># Set -&gt; 4</span>
<span class="c"># Motor1 = CCW; Motor2 = 0; Motor3= CW</span>

<span class="k">def</span> <span class="nf">VelocityPublisher_talker</span><span class="p">():</span>
    <span class="n">pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s">&#39;setStepMotorVelocity_topic&#39;</span><span class="p">,</span> <span class="n">MotorArray</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s">&#39;velocityPublisher_node&#39;</span><span class="p">)</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># 10hz</span>
    <span class="n">pos_velocity</span> <span class="o">=</span> <span class="mf">30.00</span>
    <span class="n">no_velocity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">neg_velocity</span> <span class="o">=</span> <span class="o">-</span><span class="mf">30.00</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">pos_velocity</span><span class="p">,</span><span class="n">pos_velocity</span><span class="p">,</span><span class="n">pos_velocity</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">no_velocity</span><span class="p">,</span><span class="n">no_velocity</span><span class="p">,</span><span class="n">no_velocity</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">neg_velocity</span><span class="p">,</span><span class="n">neg_velocity</span><span class="p">,</span><span class="n">neg_velocity</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">pos_velocity</span><span class="p">,</span><span class="n">no_velocity</span><span class="p">,</span><span class="n">neg_velocity</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">VelocityPublisher_talker</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../components/" title="Components" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Components
              </span>
            </div>
          </a>
        
        
          <a href="../serialLatency/" title="Serial Latency" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Serial Latency
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 PasqLab
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>